"use strict";function domReady(){if(!isReady&&(isReady=!0,readyList)){for(var a=0;a<readyList.length;a++)readyList[a].call(window,[]);readyList=[]}}function addLoadEvent(a){var b=window.onload;window.onload="function"!=typeof window.onload?a:function(){b&&b(),a()}}function bindReady(){if(!readyBound){if(readyBound=!0,document.addEventListener&&!browser.opera&&document.addEventListener("DOMContentLoaded",domReady,!1),browser.msie&&window==top&&function(){if(!isReady){try{document.documentElement.doScroll("left")}catch(a){return setTimeout(arguments.callee,0),void 0}domReady()}}(),browser.opera&&document.addEventListener("DOMContentLoaded",function(){if(!isReady){for(var a=0;a<document.styleSheets.length;a++)if(document.styleSheets[a].disabled)return setTimeout(arguments.callee,0),void 0;domReady()}},!1),browser.safari){var a;!function(){if(!isReady){if("loaded"!=document.readyState&&"complete"!=document.readyState)return setTimeout(arguments.callee,0),void 0;if(void 0===a){for(var b=document.getElementsByTagName("link"),c=0;c<b.length;c++)"stylesheet"==b[c].getAttribute("rel")&&a++;var d=document.getElementsByTagName("style");a+=d.length}return document.styleSheets.length!=a?(setTimeout(arguments.callee,0),void 0):(domReady(),void 0)}}()}addLoadEvent(domReady)}}function getByClass(a,b){var c,d,e,f,g=[];if(a.getElementsByClassName)return[].slice.apply(a.getElementsByClassName(b));if(a.querySelectorAll)for(c=a.querySelectorAll("."+b),e=0,f=c.length;f>e;e++)g.push(c[e]);else if(a.evaluate)for(d=".//*[contains(concat(' ', @class, ' '), ' "+b+" ')]",c=a.evaluate(d,a,null,0,null);e=c.iterateNext();)g.push(e);else for(c=a.getElementsByTagName("*"),d=new RegExp("(^|\\s)"+b+"(\\s|$)"),e=0;e<c.length;e++)d.test(c[e].className)&&g.push(c[e]);return g}function init(){addStyles(css),addStyles(scrollback.theme&&themes[scrollback.theme]?themes[scrollback.theme]:themes.light),addEvent(window,"resize",Stream.position),scrollback&&scrollback.streams&&scrollback.streams.forEach(function(a){var b=Stream.get(a);b.initialized||(scrollback.minimized===!1?b.show():b.hide())})}function partMembership(a,b){b.membershipHidden||(b.membershipHidden=a),-1==core.membership.indexOf(b.id)&&(addClass(a,"scrollback-hidden"),b.membershipHidden=a),addEvent(a,"click",function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),core.join("part",b.id)}),core.on("message",function(c){"part"===c.type&&c.to===b.id&&a!=b.membershipHidden&&core.nick()==c.from&&(addHiddenClass(a,b),core.membership.splice(core.membership.indexOf(b.id),1))}),core.on("membership",function(){-1==core.membership.indexOf(b.id)&&a!=b.membershipHidden&&addHiddenClass(a,b)})}function joinMembership(a,b){-1!=core.membership.indexOf(b.id)&&addHiddenClass(a,b),addEvent(a,"click",function(a){return a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),0==core.nick().indexOf("guest-")?(login(),void 0):(core.join("join",b.id),void 0)}),core.on("message",function(c){"join"==c.type&&c.to==b.id&&a!=b.membershipHidden&&core.nick()==c.from&&(addHiddenClass(a,b),core.membership.push(b.id))}),core.on("membership",function(){-1!=core.membership.indexOf(b.id)&&a!=b.membershipHidden&&addHiddenClass(a,b)})}function addHiddenClass(a,b){addClass(a,"scrollback-hidden"),removeClass(b.membershipHidden,"scrollback-hidden"),b.membershipHidden=a}function Stream(a){var b=this;b.id=a,b.stream=JsonML.parse(dom.stream,function(c){switch(!0){case hasClass(c,"scrollback-log"):b.log=c,addEvent(c,"scroll",function(){b.scroll()});break;case hasClass(c,"scrollback-nick-guest")||hasClass(c,"scrollback-nick"):b.nick=c,0!==core.nick().indexOf("guest-")?(removeClass(c,"scrollback-nick-guest"),addClass(c,"scrollback-nick"),c.innerHTML=core.nick()):c.innerHTML=core.nick().substr(6),addEvent(c,"click",function(){0===core.nick().indexOf("guest-")?login():profile()});break;case hasClass(c,"scrollback-text"):b.text=c,addEvent(c,"focus",function(){this.select()}),addEvent(c,"keydown",function(a){return 13==a.keyCode?(b.send(),!1):!0});break;case hasClass(c,"scrollback-send"):b.sendfrm=c,addEvent(c,"submit",function(a){return a.preventDefault&&a.preventDefault(),b.send(),!1});break;case hasClass(c,"scrollback-tread"):b.tread=c;break;case hasClass(c,"scrollback-thumb"):b.thumb=c;break;case hasClass(c,"scrollback-title"):b.title=c,addEvent(c,"click",function(){b.toggle()});break;case hasClass(c,"scrollback-title-id"):c.innerHTML=scrollback.title||a;break;case hasClass(c,"scrollback-title-text"):b.titleText=c;break;case hasClass(c,"scrollback-title-close"):addEvent(c,"click",function(){b.close()});break;case hasClass(c,"scrollback-icon-pop"):addEvent(c,"click",function(){b.pop()});break;case hasClass(c,"scrollback-alert"):b.alert=c;break;case hasClass(c,"scrollback-icon-login"):addEvent(c,"click",function(a){return login(),a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),!1});break;case hasClass(c,"scrollback-icon-part"):partMembership(c,b);break;case hasClass(c,"scrollback-icon-join"):joinMembership(c,b)}return c}),b.requested={},addEvent(b.stream,"click",function(){b.select()}),document.body.appendChild(b.stream)}function login(a){a=a||{},a.requireAuth&&Stream.text&&Stream.prevText&&(Stream.text.value=Stream.prevText,delete Stream.text,delete Stream.prevText),dialog.show("/dlg/login"+(a.requireAuth?"?requireAuth=1":"")+"#"+core.nick(),function(a){var b;a&&(a.assertion?b={browserid:a.assertion}:a.guestname&&(b="guest-"+a.guestname),b&&core.nick(b,function(a){scrollback.debug&&console.log(a.message),a.message?("AUTH_UNREGISTERED"==a.message&&(scrollback.debug&&console.log("calling profile...."),profile()),dialog.send("error",a.message)):dialog.hide()}))})}function profile(){dialog.show("/dlg/profile",function(a){return a?a.guestname?(core.nick(a.guestname,function(){dialog.hide()}),void 0):(core.nick({user:a},function(a){a.message?dialog.send("error",a.message):dialog.hide()}),void 0):(dialog.hide(),void 0)})}function hashColor(a){function b(a){var b,c,d=7;for(a=a.toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/^\s+/g,"").replace(/\s+$/g,""),b=0,c=a.length;c>b;b++)d=(31*d+479*a.charCodeAt(b))%1531;return d%1530}function c(a){function b(a){var b=a.toString(16);return b=1==b.length?"0"+b:b}function c(a,c,d){return"#"+b(a)+b(c)+b(d)}return 255>a?c(255,a,0):510>a?c(255-(a-255),255,0):765>a?c(0,255,a-510):1020>a?c(0,255-(a-765),255):1275>a?c(a-1020,0,255):c(255,0,255-(a-1275))}return a?(a=a.toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/^\s+/g,"").replace(/\s+$/g,""),c(b(a))):"#999"}var setStyle=function(a,b){if("object"==typeof b){for(var c in b)if(b.hasOwnProperty(c))try{a.style[c]=b[c]}catch(d){}}else"undefined"!=typeof a.style.cssText?a.style.cssText=b:a.style=b},addStyles=function(a){function b(a,b){var c,d,e="";if(a=a.replace(/([A-Z]?)([a-z]*)/g,function(a,b,c){if(b)return"-"+b.toLowerCase()+c;switch(c){case"webkit":case"moz":case"ms":case"o":return"-"+c;default:return c}}),"object"==typeof b&&(d=b.length))for(c=0;d>c;c++)e+=a+":"+b[c]+"; ";else e+=a+":"+b+"; ";return e}var c,d,e="";if("object"==typeof a){for(d in a)if(a.hasOwnProperty(d)){e+=d+" { ";for(c in a[d])a[d].hasOwnProperty(c)&&(e+=b(c,a[d][c]));e+=" } "}}else e=a;var f=document.createElement("style");return document.getElementsByTagName("head")[0].appendChild(f),f.styleSheet?f.styleSheet.cssText=e:f.appendChild(document.createTextNode(e)),f},themes={},css={".scrollback-hidden":{position:"absolute",visibility:"hidden"},".scrollback-stream":{position:"fixed",width:"480px",height:"480px",bottom:"0px",boxShadow:"0px 0px 8px 0 rgba(0,0,0,0.5)",boxSizing:"border-box",webkitBoxSizing:"border-box",mozBoxSizing:"border-box",msBoxSizing:"border-box",oBoxSizing:"border-box",fontSize:"13px",lineHeight:"14px",transition:"height 0.2s ease-out",webkitTransition:"height 0.2s ease-out",mozTransition:"height 0.2s ease-out",oTransition:"height 0.2s ease-out",msTransition:"height 0.2s ease-out",overflow:"hidden"},".scrollback-stream-hidden":{height:"44px !important"},".scrollback-alert":{backgroundColor:"#3CA",color:"#fff",width:"100%",position:"absolute",top:"44px",zIndex:"9998",transition:"all 0.2s ease-out",webkitTransition:"all 0.2s ease-out",mozTransition:"all 0.2s ease-out",oTransition:"all 0.2s ease-out",msTransition:"all 0.2s ease-out",fontSize:"13px",lineHeight:"24px",padding:"0px 16px",height:"24px"},".scrollback-alert-hidden":{height:"0px",top:"0px",zIndex:9996},".scrollback-stream-hidden .scrollback-title-text":{display:"inline"},".scrollback-stream-hidden .scrollback-title-id, .scrollback-stream-hidden .scrollback-icon-login, .scrollback-stream-hidden .scrollback-icon-logout":{display:"none"},".scrollback-stream-right .scrollback-title":{"text-align":"right"},".scrollback-stream-right.scrollback-stream-hidden .scrollback-title-text":{display:"none"},".scrollback-icon":{top:"0",margin:"0 0px",width:"40px",height:"40px",cursor:"pointer",zIndex:2,fontWeight:"bold",lineHeight:"40px",textIndent:"-9999px",backgroundRepeat:"no-repeat",backgroundPosition:"center center","float":"right"},".scrollback-icon.scrollback-icon-menu":{"float":"left"},".scrollback-title":{height:"40px",lineHeight:"40px",boxSizing:"content-box",webkitBoxSizing:"content-box",mozBoxSizing:"content-box",msBoxSizing:"content-box",oBoxSizing:"content-box",left:"0px",right:"0px",position:"absolute",fontWeight:"bold",borderBottom:"4px solid transparent",zIndex:9997,top:"0",cursor:"default"},".scrollback-title-content":{padding:"0 2px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},".scrollback-title-text":{paddingLeft:"8px",fontWeight:"normal",display:"none"},".scrollback-log":{boxSizing:"border-box",webkitBoxSizing:"border-box",mozBoxSizing:"border-box",msBoxSizing:"border-box",oBoxSizing:"border-box",position:"absolute",top:"44px",bottom:"41px",left:"0",right:"0",overflowY:"auto",overflowX:"hidden"},".scrollback-message":{overflow:"hidden",padding:"2px 24px 2px 48px",textIndent:"-32px",borderLeft:"4px solid transparent",opacity:1,height:"auto",cursor:"default"},".scrollback-message.scrollback-message-mentioned .scrollback-message-content":{color:"#c00"},".scrollback-message-hidden":{opacity:0,height:0,transition:"all 1s ease-out",webkitTransition:"all 1s ease-out",mozTransition:"all 1s ease-out",oTransition:"all 1s ease-out",msTransition:"all 1s ease-out"},".scrollback-timestamp-hidden .scrollback-message-timestamp":{display:"none"},".scrollback-message-timestamp":{display:"block",textAlign:"right",marginRight:"-16px"},".scrollback-timeline":{position:"absolute",top:"44px",right:"0",width:"18px",bottom:"41px",zIndex:9996},".scrollback-tread":{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:1},".scrollback-tread-row":{position:"absolute",height:"2px",right:"0",transition:"all .2s linear",webkitTransition:"all 0.2s linear",mozTransition:"all 0.2s linear",oTransition:"all 0.2s linear",msTransition:"all 0.2s linear"},".scrollback-thumb":{position:"absolute",left:"0px",width:"18px",zIndex:2},".scrollback-send":{position:"absolute",padding:"0",margin:"0",bottom:"0px",left:"0px",right:"0px",height:"40px",background:"#fff"},".scrollback-nick, .scrollback-text, .scrollback-nick-guest":{display:"block",border:"none",boxSizing:"border-box",webkitBoxSizing:"border-box",mozBoxSizing:"border-box",msBoxSizing:"border-box",oBoxSizing:"border-box",padding:"0 4px",height:"40px",fontSize:"1em",borderRadius:"0"},".scrollback-nick, .scrollback-text-wrap, .scrollback-nick-guest":{position:"absolute",top:"0",margin:"0"},".scrollback-text:focus":{outline:"none"},".scrollback-nick, .scrollback-nick-guest":{lineHeight:"40px",cursor:"pointer",width:"80px",borderTop:"1px solid #ccc",background:"#ccc",backgroundRepeat:"no-repeat",backgroundPosition:"left center"},".scrollback-text-wrap":{right:"0px",left:"80px"},".scrollback-text":{width:"100%"},".scrollback-icon-popup":{position:"fixed",background:"#f70"},".scrollback-dialog-layer":{position:"fixed",display:"none",top:0,left:0,width:"100%",height:"100%",background:"rgba(255,255,255,0.9)",overflow:"auto",zIndex:999998},".scrollback-dialog":{position:"absolute",top:0,left:0,bottom:0,right:0,width:"360px",height:"400px",margin:"auto",background:"#fff",boxShadow:"0 4px 8px 0 rgba(0,0,0,0.25)"},".scrollback-dialog-close":{display:"block",position:"absolute",top:"0",right:"0",textDecoration:"none",color:"#000",lineHeight:"40px",width:"40px",textAlign:"center",cursor:"pointer",padding:"0px",backgroundColor:"#000 !important"},".scrollback-dialog-close:hover":{backgroundColor:"#555 !important"},".scrollback-dialog-frame":{display:"block",width:"100%",height:"100%",background:"transparent"}};themes.light={".scrollback-stream":{background:"#eee",color:"#000"},".scrollback-icon":{color:"#fff",backgroundColor:"#555"},".scrollback-icon:hover":{backgroundColor:"#000"},".scrollback-icon-menu":{backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoAgMAAADxkFD+AAAACVBMVEUnCBAzzKr///9dqy57AAAAAXRSTlMAQObYZgAAAE9JREFUGNNjYKA7YHSAM1kD4EzREDgzNBSuNETUAa4UrljUgTEErw1aq1atwMvEoa2BCaaAawHXAiiTaYVWA0zFqlUIxQiz4EqBihvoFIgAj/ARaE+bLvMAAAAASUVORK5CYII=')"},".scrollback-icon-hide":{backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAABpSURBVFiF7dcxDoAgDEBRMR6Mm3m13qwuOCP9g8b8l3Sj4SdMtMzcvmx/O2DGQMpAykDKQMpAykDKQMpA6ijs9DEVMeaxauBZ2LvFyuFfPnGA+5Z3m786yEDKQMpAykDKQMpAykDKQOoC4wMLTudjPd8AAAAASUVORK5CYII=')"},".scrollback-icon-close":{backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADYSURBVFiF7dZBCsIwFIThSfQAHsUDeE4FkZ5Gtz2Ma3VcNIs0aEsyT8zi/VDUYM2HksRAEj0X/w1Yy4FqDlRzoJoD1Ryo5kC1bcM9OwD77PULwDU95kUAB8y/hBHAvWo2krVXJDlw3pDGl95zJBlq52sBriHNcApwCWmGU4HfkGY4kgjU//J/WgwA8ABwAyBN0P020/1PbI07pcsMaYk7J0hIz02QVrhLAQhpTEa2rOLyqHtiOurKDwqYVvcmG6s+6iy2mZ/W/TbjQDUHqjlQzYFqDlRzoNobBUUWkfO1saUAAAAASUVORK5CYII=')"},".scrollback-icon.scrollback-icon-pop":{width:"80px",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAoCAYAAABpYH0BAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAN6SURBVGiB7dhbiFV1FMfxzzRpjpljTkQXoWKKyFCiwCaMyjIiuln40IPV9NCVoDuVD0F0kSKihx6sl4p6KKiXCoKk14KCJpACK5ugki4jlY0Zik0Pa+nsczzp3mcfSJn9hc1e/7P/a/3X/u313///2X1TU1Mauuew/zuBQ51GwJo0AtakEbAmjYA1aQSsSSNgTRoBa9IIWJOZJuAS/IKpEkcpZpqAG3EJfu1VwJkmID0Wsa/5mNBCUYy+Mg4zsQJ7SiNgTRoBa9II2ErlhaURsJXKq3MjYCuVtzgHs4Aj+C6PEdxTaMOzPRyrGGuPiKU4vIdJ9Jo5OKlgLyi04ZgejtUea2NZx24rcC4uwjIMtF07Hiuw2PRm9CycmfYCXIojsn1kxhnB7Ao5VN70ttGNzz50U4EvYRSzsj2JpdiCF3FjIbmtOBVj4oavx8viAQziqox3dPb/G7fitRJ57MRdYrrtynxuwQSG8WDGG8AGvJV+9+JKfJF+97fFXZk5ry+RQ2UBl2SSsE5U8DDG8Shuymuf4ffCQYj6Zto7MB+viArcJG58uRB4U4lcTsHnuDbby3AbnsS3uL3Qd70QcE3mvFLnLy5n57WHS4yP6lN4smDfjD9FNcLqPI/hHFEZq7WyWdzocbhMiAercLGoiH5cUSKXWXiv0P4Ep6fdPr0nxKtlVDy0dvH+EYUwirUlxt5LVQHHxZPdJkR4Qgg2iEXZp/gCbk/0bXya/icUfv9eTMmfs724RC5b069If55PxuN4Gk/hfPHO3Z5+7Qxlv5+EmKWpKuAgXhVPa13+dhouNH0zy7PffFFZRXYU7G8K9lIsxInZHi+Ry5B9V8+deV4rtiYP4ZFCvKMwr0OshWJ6z8EFJcbeS1UBV4hN5ju4On/7Cx/h9WwP4wcxbd7YT6x38WPaH+BLMd12iWlWNp89nIGv0p6HP9IewDWFMa/rEGdzjvsY7lBhi1R1EZkQK9t5YnqOiZV3As+LLcqded6C9/cTaxKXp/+54qa/xn1CzGMPkMuHYmu0KnNahBvy2obMh1jxn0n7hTzW4OPM8+5CzN14AM+JBfGAH0u7+aDaJ7Ydu00/5XaGdH7X/BcDYlHYVjUZUQRzO/j2iym5vYPPbLGA/dbFeC00X6RrcjD/Fz4kaASsSSNgTRoBa9IIWJNGwJo0AtakEbAm/wJb7LLbQAfwGAAAAABJRU5ErkJggg==')"},".scrollback-icon-login":{backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFiSURBVFiF7ZZBToQwFIY/Jh5jErtg7jGeQxccw6VLL2EyCz2HeA5cQOQezwVV6kyhdPrQSeyXEJo++PvzXltaiAiXzOavDYTIBlPJBlPJBlPJBlO5WkFzC9x5+p+BPlpNRDSvrYg04qex8SjN3zJ3tslC8bDQAKVt98CLE7tlKD3AO7BbKqpp0BXaWSNflAwf8D3uUtG1DPoMhOJe/sU2c7+wzxd/DIlrlDhFIFhqjRJ3ChqTxGbQAJVtH4D2qM9HBVxPjR8cMWLTNCLSOptua/ti33NR3ahbTyY6hkxOcWDMcu15P5jBGIPnLIY3YG/be+D1ePyQQMw20zGfwcrG3UVT2bthPtPTKM5BIyIP9m6c2NQc/FjjsGA4XcWh52tOM98DN/z8X3vR/BdX1hCM5axJMAeongfdUrYzZS1jdDUzCOMUKJxr47SfFmfOom1QnYs/bmWDqWSDqWSDqWSDqXwChnTRHUZCC4gAAAAASUVORK5CYII=')"},".scrollback-icon-logout":{backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADzSURBVFiF7ZaxDcIwFEQvCCVz0DMEY6REtCyRkhEoWQGEmIOCjk0ocjRGCpYJji+EKPpPuib2t5+UL9sZSYyZ2b8FvmGCKiaoYoIqJqgy72GNAsAewML7fgewBfCQVieppCB54WeOJHNlD0UuJ3luketFUhE8eSI7kiuXXUBycMEmVWC88uYk7ZMx/bnVLMyEOa1M8phZujQpI+pKADeXeBL6wu+tLoR6tTWj/8UmqGKCKpMUvOL9hoiFrrZjVdoduSFZdzj/alcz6GMhVjJZThWMkZTkKL5mXqxdQhxckulD8KdM8pgZFBNUMUEVE1QZveATwcwl121kDn4AAAAASUVORK5CYII=')"},".scrollback-icon-join, .scrollback-icon-part":{width:"auto",textIndent:"0",padding:"0 8px"},".scrollback-title":{backgroundColor:"#555",color:"#fff",borderBottomColor:"#3ca"},".scrollback-title-text":{color:"#ccc"},".scrollback-log":{color:"#000"},".scrollback-message":{color:"#999"},".scrollback-message-nick":{color:"#999"},".scrollback-message-separator":{color:"#ccc"},".scrollback-message-timestamp":{color:"#999"},".scrollback-message-content":{color:"#000"},".scrollback-timeline":{background:"#eee"},".scrollback-thumb":{background:"transparent",borderLeft:"2px solid #555",borderRight:"none"},".scrollback-nick, .scrollback-text":{borderTop:"1px solid #ccc"},".scrollback-nick":{color:"#555",background:"#eee"},".scrollback-text":{background:"#fff",color:"#000"}},themes.dark={".scrollback-stream":{background:"#555",color:"#fff"},".scrollback-icon":{color:"#fff",backgroundColor:"#555"},".scrollback-icon:hover":{backgroundColor:"#555"},".scrollback-icon-menu":{backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFVSURBVFiF7dZBToNAFAbgf4oLb9E5gkQPQGLKsmxYeBuvw8KNW5MmHEArR6CHELqhvwsfaWMmUWaelej8yQsJMw++QGbAkMScs/htwFeJwNBEYGgiMDT/C5g2lU2bympeUw2YNpVNhqROhqTWRKoARxyAJYClJjIY+Ak3Rg0ZBHTgOilACekNdOD6w8KsDwuzBtBrIb2ADtzeEMU2LTfbtNwYogCw10Caqf+DLhxgiufr8ul03s3LQw7wEcClnNoNyZC9Xt21Pwo8dy48ejIpn9RS344v8N6jb0w9ZfLsv8U+T7AOuN/k3tkvEp9XbAG0ACjVA8gd83IZG+e10jstJH3Kkmx5TE9ydTK+knNjWumZfC9foAvZkbyV6jRwoUAX8k1KBacBdCHVcFpAF1IFR1J1m7E47nMZPlZtcLT3QSvHVuuCf3KjPmsiMDQRGJoIDM3sge8GnOys45umtwAAAABJRU5ErkJggg==')"},".scrollback-icon-hide":{backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAABpSURBVFiF7dcxDoAgDEBRMR6Mm3m13qwuOCP9g8b8l3Sj4SdMtMzcvmx/O2DGQMpAykDKQMpAykDKQMpA6ijs9DEVMeaxauBZ2LvFyuFfPnGA+5Z3m786yEDKQMpAykDKQMpAykDKQOoC4wMLTudjPd8AAAAASUVORK5CYII=')"},".scrollback-icon-close":{backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADYSURBVFiF7dZBCsIwFIThSfQAHsUDeE4FkZ5Gtz2Ma3VcNIs0aEsyT8zi/VDUYM2HksRAEj0X/w1Yy4FqDlRzoJoD1Ryo5kC1bcM9OwD77PULwDU95kUAB8y/hBHAvWo2krVXJDlw3pDGl95zJBlq52sBriHNcApwCWmGU4HfkGY4kgjU//J/WgwA8ABwAyBN0P020/1PbI07pcsMaYk7J0hIz02QVrhLAQhpTEa2rOLyqHtiOurKDwqYVvcmG6s+6iy2mZ/W/TbjQDUHqjlQzYFqDlRzoNobBUUWkfO1saUAAAAASUVORK5CYII=')"},".scrollback-icon-pop":{backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAERSURBVFiF7ZgxTsNAEEWfDcpBwg2ouQE9DQVE4lhRoHGFKLkBx6DgBBwAkXwKbyTjIDnsH4SLedJordV65ml2V7LcSGLOtP8tMEUKuqSgSwq6pKBLCrrMXvDUfH8BXB2Z5wV4/W0BV/ADELAGTibWrqgQjNjiDrgBtgG5DnA7uKej7+blaP4COHMSRwkCPAJP5XlXxgdMwchb3NKfxXVk3qgO7uVWg7m7qMQROcZyYbiCP8nd03dvBzzj3m5JtdFK2ug7mzI/XHct6VPSbU2d2jM41bkhXRmbqkqV3VtKep/o3DgWNbWcLT4vksfIVUcj78/CEnjjcFvDcAX/nNl/D6agSwq6pKBLCrqkoMvsBb8A4W6WiJ7YEGsAAAAASUVORK5CYII=')"},".scrollback-title":{backgroundColor:"#555",color:"#fff",borderBottomColor:"#3ca"},".scrollback-title-text":{color:"#ccc"},".scrollback-log":{color:"#fff"},".scrollback-message-nick":{color:"#999"},".scrollback-message-separator":{color:"#999"},".scrollback-message-join, .scrollback-message-part":{color:"#999"},".scrollback-message-timestamp":{color:"#999"},".scrollback-timeline":{background:"#555"},".scrollback-tread-row":{background:"#fff"},".scrollback-thumb":{background:"#000"},".scrollback-nick, .scrollback-text":{borderTop:"1px solid #ccc"},".scrollback-nick":{color:"#555",background:"#eee"},".scrollback-text":{background:"#ccc",color:"#000"}};var dom={stream:["div",{"class":"scrollback-stream"},["div",{"class":"scrollback-alert scrollback-alert-hidden"}],["div",{"class":"scrollback-title"},["span",{"class":"scrollback-icon scrollback-icon-menu"},"menu"],scrollback.close?["div",{"class":"scrollback-icon scrollback-icon-close"}]:"",["div",{"class":"scrollback-icon scrollback-icon-pop"},"on scrollback"],["span",{"class":"scrollback-icon scrollback-icon-part scrollback-hidden"},"Unfollow"],["span",{"class":"scrollback-icon scrollback-icon-join"},"Follow"],["div",{"class":"scrollback-title-content"},["span",{"class":"scrollback-title-id"}],["a",{href:"//scrollback.io","class":"scrollback-poweredby",target:"_blank"}],["span",{"class":"scrollback-title-text"}]]],["div",{"class":"scrollback-timeline"},["div",{"class":"scrollback-tread"}],["div",{"class":"scrollback-thumb"}]],["div",{"class":"scrollback-log"}],["form",{"class":"scrollback-send"},["div",{"class":"scrollback-nick-guest"}],["div",{"class":"scrollback-text-wrap"},["input",{"class":"scrollback-text"}]],["button",{type:"submit","class":"scrollback-hidden"},"Send"]]]},DomReady={},userAgent=navigator.userAgent.toLowerCase(),browser={version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)},readyBound=!1,isReady="interactive"==document.readyState||"loaded"==document.readyState||"complete"==document.readyState,readyList=[];DomReady.ready=function(a){bindReady(),isReady?a.call(window,[]):readyList.push(function(){return a.call(window,[])})},bindReady();var JsonML=JsonML||{};!function(a){function b(a,b,c){"string"==typeof c&&(c=new Function("event",c)),"function"==typeof c&&addEvent(a,m[b],c)}function c(a,c){if(c.name&&document.attachEvent)try{var d=document.createElement("<"+a.tagName+' name="'+c.name+'">');a.tagName===d.tagName&&(a=d)}catch(e){}for(var f in c)if(c.hasOwnProperty(f)){var g=c[f];f&&null!==g&&"undefined"!=typeof g&&(f=k[f.toLowerCase()]||f,"style"===f?setStyle(a,g):"class"===f?a.className=g:m[f]?(b(a,f,g),l[f]&&b(a,l[f],g)):"string"==typeof g||"number"==typeof g||"boolean"==typeof g?(a.setAttribute(f,g),l[f]&&a.setAttribute(l[f],g)):(a[f]=g,l[f]&&(a[l[f]]=g)))}return a}function d(a,b){if(b)if(a.tagName&&"table"===a.tagName.toLowerCase()&&a.tBodies){if(!b.tagName){if(11===b.nodeType)for(;b.firstChild;)d(a,b.removeChild(b.firstChild));return}var c=b.tagName.toLowerCase();if(c&&"tbody"!==c&&"thead"!==c){var e=a.tBodies.length>0?a.tBodies[a.tBodies.length-1]:null;e||(e=document.createElement("th"===c?"thead":"tbody"),a.appendChild(e)),e.appendChild(b)}else a.canHaveChildren!==!1&&a.appendChild(b)}else if(a.tagName&&"style"===a.tagName.toLowerCase()&&document.createStyleSheet)a.cssText=b;else if(a.canHaveChildren!==!1)a.appendChild(b);else if(a.tagName&&"object"===a.tagName.toLowerCase()&&b.tagName&&"param"===b.tagName.toLowerCase()){try{a.appendChild(b)}catch(f){}try{a.object&&(a.object[b.name]=b.value)}catch(g){}}}function e(a){return a&&3===a.nodeType&&(!a.nodeValue||!/\S/.exec(a.nodeValue))}function f(a){if(a){for(;e(a.firstChild);)a.removeChild(a.firstChild);for(;e(a.lastChild);)a.removeChild(a.lastChild)}}function g(a){var b=document.createElement("div");if(b.innerHTML=a,f(b),1===b.childNodes.length)return b.firstChild;for(var c=document.createDocumentFragment?document.createDocumentFragment():document.createElement("");b.firstChild;)c.appendChild(b.firstChild);return c}function h(a){this.value=a}function i(a){return document.createTextNode("["+a+"]")}function j(b,e,f){for(var i=1;i<e.length;i++)e[i]instanceof Array||"string"==typeof e[i]?d(b,a.parse(e[i],f)):e[i]instanceof h?d(b,g(e[i].value)):"object"==typeof e[i]&&null!==e[i]&&1===b.nodeType&&(b=c(b,e[i]));return b}var k={rowspan:"rowSpan",colspan:"colSpan",cellpadding:"cellPadding",cellspacing:"cellSpacing",tabindex:"tabIndex",accesskey:"accessKey",hidefocus:"hideFocus",usemap:"useMap",maxlength:"maxLength",readonly:"readOnly",contenteditable:"contentEditable"},l={enctype:"encoding",onscroll:"DOMMouseScroll"},m=function(a){for(var b={};a.length;){var c=a.shift();b["on"+c.toLowerCase()]=c}return b}("blur,change,click,dblclick,error,focus,keydown,keypress,keyup,load,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,resize,scroll,select,submit,unload".split(","));a.raw=function(a){return new h(a)},a.onerror=null,a.parse=function(b,c){try{if(!b)return null;if("string"==typeof b)return document.createTextNode(b);if(b instanceof h)return g(b.value);if(!a.isElement(b))throw new SyntaxError("invalid JsonML");var e=b[0];if(!e){for(var k=document.createDocumentFragment?document.createDocumentFragment():document.createElement(""),l=1;l<b.length;l++)d(k,a.parse(b[l],c));return f(k),1===k.childNodes.length?k.firstChild:k}if("style"===e.toLowerCase()&&document.createStyleSheet)return a.patch(document.createStyleSheet(),b,c),null;var m=j(document.createElement(e),b,c);return f(m),m&&"function"==typeof c?c(m):m}catch(n){try{var o="function"==typeof a.onerror?a.onerror:i;return o(n,b,c)}catch(p){return document.createTextNode("["+p+"]")}}},a.patch=function(a,b,c){return j(a,b,c)},a.isElement=function(a){return a instanceof Array&&"string"==typeof a[0]},a.isFragment=function(a){return a instanceof Array&&""===a[0]},a.getTagName=function(a){return a[0]||""},a.isAttributes=function(a){return!(!a||"object"!=typeof a||a instanceof Array)},a.hasAttributes=function(b){if(!a.isElement(b))throw new SyntaxError("invalid JsonML");return a.isAttributes(b[1])},a.getAttributes=function(b,c){if(a.hasAttributes(b))return b[1];if(!c)return void 0;var d=b.shift(),e={};return b.unshift(e),b.unshift(d||""),e},a.addAttributes=function(b,c){if(!a.isElement(b)||!a.isAttributes(c))throw new SyntaxError("invalid JsonML");if(!a.isAttributes(b[1])){var d=b.shift();return b.unshift(c),b.unshift(d||""),void 0}var e=b[1];for(var f in c)c.hasOwnProperty(f)&&(e[f]=c[f])},a.getAttribute=function(b,c){return a.hasAttributes(b)?b[1][c]:void 0},a.setAttribute=function(b,c,d){a.getAttributes(b,!0)[c]=d},a.appendChild=function(b,c){if(c instanceof Array&&""===c[0])for(c.shift();c.length;)a.appendChild(b,c.shift(),arguments[2]);else if(c&&"object"==typeof c)if(c instanceof Array){if(!a.isElement(b)||!a.isElement(c))throw new SyntaxError("invalid JsonML");"function"==typeof arguments[2]&&arguments[2](b,c),b.push(c)}else if(c instanceof h){if(!a.isElement(b))throw new SyntaxError("invalid JsonML");b.push(c)}else a.addAttributes(b,c);else if("undefined"!=typeof c&&null!==c){if(!(b instanceof Array))throw new SyntaxError("invalid JsonML");c=String(c),c&&b.length>1&&"string"==typeof b[b.length-1]?b[b.length-1]+=c:(c||!b.length)&&b.push(c)}},a.getChildren=function(b){a.hasAttributes(b)&&b.slice(2),b.slice(1)}}(JsonML);var streams={},$$=getByClass,unconfirmed=[],initialized=!1;core.on("connected",function(){initialized||(init(),initialized=!0),getByClass(document,"scrollback-text").forEach(function(a){a.disabled=!1,a.value=""}),getByClass(document,"scrollback-nick").forEach(function(a){a.disabled=!1}),scrollback&&scrollback.streams&&scrollback.streams.forEach(function(a){streams[a]&&streams[a].notify("And... we're back.")})}),core.on("disconnected",function(){getByClass(document,"scrollback-text").forEach(function(a){a.disabled=!0,a.value="Disconnected"}),getByClass(document,"scrollback-nick").forEach(function(a){a.disabled=!0}),scrollback.streams.forEach(function(a){streams[a].notify("Disconnected. Refresh page to reconnect.",!0)})}),core.on("enter",function(){}),core.on("leave",function(){}),core.on("nick",function(a){var b,c,d=a.replace(/^guest-/,"");for(b in streams)streams.hasOwnProperty(b)&&(c=streams[b],c.nick.innerHTML=d,0!==a.indexOf("guest-")&&(removeClass(c.nick,"scrollback-nick-guest"),addClass(c.nick,"scrollback-nick")))}),core.on("message",function(a){a.to&&streams[a.to]&&streams[a.to].onmessage(a)}),Stream.prototype.close=function(){delete streams[this.id],core.leave(this.id),document.body.removeChild(this.stream),Stream.position()},Stream.prototype.pop=function(){window.open(scrollback.host+"/"+this.id+"/","_blank")},Stream.prototype.toggle=function(){this.hidden?this.show():this.hide(),Stream.position()},Stream.prototype.hide=function(){removeClass(this.stream,"scrollback-stream-selected"),addClass(this.stream,"scrollback-stream-hidden"),this.hidden=!0},core.on("error",function(a){"AUTH_UNREGISTERED"===a&&profile(),"AUTH_REQ_TO_POST"===a&&login({requireAuth:1})}),Stream.prototype.show=function(){var a=this;removeClass(this.stream,"scrollback-stream-hidden"),setTimeout(function(){a.initialized||(a.bottom=!0,core.watch(a.id,null,32,0,function(b){a.update(b)}),a.initialized=!0)},250),this.hidden=!1},Stream.prototype.send=function(){var a,b,c,d=this.text.value;if(d){if(Stream.text=this.text,Stream.prevText=this.text.value,this.text.value="","/"==d[0])switch(a=d.substr(1).split(" "),a[0]){case"nick":return b=core.nick(),0!=b.indexOf("guest-")?this.notify("You can't change your nick while you're signed in."):(c=this,core.nick("guest-"+a[1],function(){c.nick.innerHTML=a[1],c.rename()})),void 0;case"leave":return scrollback.close&&this.close(),void 0}this.log.scrollTop=this.log.scrollHeight,core.say(this.id,d)}},Stream.prototype.notify=function(a,b){var c=this;this.hidden||(this.alert.innerHTML="<span>"+a+"</span>",removeClass(this.alert,"scrollback-alert-hidden"),clearTimeout(this.alertTimer),b||(this.alertTimer=setTimeout(function(){addClass(c.alert,"scrollback-alert-hidden")},2e3)))},Stream.prototype.onmessage=function(a){var b=this.renderMessage(a);"join"!==a.type&&"part"!==a.type&&("text"==a.type?(a.from!=core.nick()&&browserNotify(a.from.replace(/^guest-/g,"")+" : "+a.text,hasClass(b,"scrollback-message-mentioned")),this.titleText.innerHTML=b.innerText||b.textContent):core.nick()!==a.ref&&a.ref!=a.from&&this.notify(b.innerText||b.textContent))},Stream.prototype.rename=function(){var a=this.nick.innerText||this.nick.textContent;core.nick(a)},Stream.prototype.select=function(){var a,b=$$(document,"scrollback-stream"),c=b.length;for(a=0;c>a;a+=1)removeClass(b[a],"scrollback-stream-selected");addClass(this.stream,"scrollback-stream-selected"),Stream.position()},Stream.get=function(a){if(!a)throw"Can't get a stream with no ID!";return streams[a]?streams[a]:(streams[a]=new Stream(a),Stream.position(),streams[a])},Stream.stack=function(){var a,b,c=$$(document,"scrollback-stream"),d=c.length,e=0,f=1;for(a=0;d>a;a+=1)b=c[a],hasClass(b,"scrollback-stream-selected")&&(f=-1),b.style.zIndex=d+e,e+=f},Stream.position=function(){var a,b,c,d,e,f,g=scrollback.maxWidth||400,h=scrollback.maxHeight||400,i=scrollback.minWidth||250,j=scrollback.minHeight||44,k=scrollback.maxGap||20,l=scrollback.minPitch||120,m=scrollback.margin||40,n=$$(document,"scrollback-stream"),o=n.length,p=1,q=0,r=!1,s=document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight;for(i+2*m+l*(o-1)>s?(r=!0,f=0,b=s,m=0,c=Math.min(h,t-j*(o-1))):g+2*m+l*(o-1)>s?(r=!1,f=l,b=s-2*m-(o-1)*l,c=Math.min(h,t)):(r=!1,b=g,f=Math.min((s-b-2*m)/(o-1),g+k),c=Math.min(h,t)),a=0;o>a;a+=1)d=n[a],d.style.right=m+a*f+"px",d.style.width=b+"px",hasClass(d,"scrollback-stream-selected")&&(p=-1),r?(e=hasClass(d,"scrollback-stream-selected")?c:j,d.style.height=e+"px",d.style.bottom=q+"px",q+=e,removeClass(d,"scrollback-stream-right")):(e=hasClass(d,"scrollback-stream-hidden")?j:c,d.style.height=Math.round(e)+"px",d.style.bottom="0px",0>p||f>=b||a===o-1?removeClass(d,"scrollback-stream-right"):addClass(d,"scrollback-stream-right"));
Stream.stack()},Stream.prototype.scroll=function(){var a,b,c,d=this.log,e=d.firstChild,f=0,g=99999,h=0,i=this,j=offset(d)[1]+d.scrollTop,k=j+d.clientHeight;if(!this.updating){for(;e;)a=offset(e)[1],a>=j&&k>=a&&(g>f&&(g=f),f>h&&(h=f)),e=e.nextSibling,f++;if("undefined"==typeof this.lastScrollTop)return this.lastScrollTop=d.scrollTop,void 0;b=d.scrollTop<this.lastScrollTop,this.lastScrollTop=d.scrollTop,this.scrollId=this.messages[g].id,this.scrollPx=offset(this.log.children[g])[1]-offset(this.log)[1]-this.log.scrollTop,this.requested[b?"dn":"up"]=!1,g>=10&&(i.requested.up=!1),i.messages.length-h>=10&&(i.requested.dn=!1),this.renderThumb(g,h),h>=i.messages.length-1&&!b?(scrollback.debug&&console.log("bottomed out"),this.bottom=!0):this.bottom=!1,c=function(a){i.update(a)},this.bottom?core.watch(i.id,null,3*(h-g)+10,0,c):(core.unwatch(i.id),!this.requested[b?"up":"dn"]&&(b&&10>g||!b&&i.messages.length-h<10)&&(this.requested[b?"up":"dn"]=!0,core.watch(i.id,i.messages[g].time,h-g+10,2*(h-g)+10,c)))}},Stream.prototype.update=function(a){var b,c,d=this;if(this.messages=a,this.updating=!0,this.renderLog(),this.renderTimeline(),this.bottom)this.log.scrollTop=this.log.scrollHeight;else{for(b=0,c=this.messages.length;c>b&&this.messages[b].id!=d.scrollId;b++);this.log.scrollTop=offset(this.log.children[b])[1]-offset(this.log)[1]-this.scrollPx}this.lastScrollTop=this.log.scrollTop,setTimeout(function(){d.updating=!1},100)},Stream.prototype.renderLog=function(){var a,b,c=this;this.hidden||(this.log.innerHTML="",this.messages.forEach(function(d){a&&(b=c.renderMessage(a,d.time-a.time>6e4),b&&c.log.appendChild(b)),a=d}),a&&c.log.appendChild(c.renderMessage(a,!0)))},Stream.prototype.renderThumb=function(a,b){var c,d,e=core.cache(this.id),f=(this.log,this.messages[a].time),g=this.messages[b].time,h=e[0].time,i=e[e.length-1].time-h;this.hidden||(c=Math.round((f-h)*this.tread.clientHeight/i),d=Math.round((g-f)*this.tread.clientHeight/i),this.thumb.style.top=c+"px",this.thumb.style.height=Math.max(2,d)+"px")},Stream.prototype.renderTimeline=function(){if(!this.hidden){var a,b,c,d,e,f,g=[],h=4,i=Math.floor(this.tread.clientHeight/h),j=0,k=18,l=["div"],m=0,n=core.cache(this.id);if(this.tread.innerHTML="",n.length){for(c=n[0],b=n.length,d=c.time||0,e=n[b-1].time-d,j=0;b>j;j++)c=n[j],"text"===c.type&&(a=Math.floor((c.time-d)*i/e),g[a]||(g[a]={nicks:{},n:0,dominant:{nick:c.from,count:1}}),g[a].nicks[c.from]=(g[a].nicks[c.from]||0)+(c.text||"").length,g[a].dominant.count<=g[a].nicks[c.from]&&(g[a].dominant={nick:c.from,count:g[a].nicks[c.from]}),g[a].n+=c.text.length,g[a].n>m&&(m=g[a].n));for(a=0;i>a;a+=1)g[a]&&(f=["div",{"class":"scrollback-tread-row scrollback-user-"+Object.keys(g[a].nicks).join(" scrollback-user-"),style:{top:Math.round(a*h)+"px",width:Math.round(h+g[a].n*(k-h)/m)+"px",background:hashColor(g[a].dominant.nick)}}],l.push(f));this.tread.appendChild(JsonML.parse(l))}}},Stream.prototype.renderMessage=function(a,b){function c(a){if(!a)return"";for(var b,c,d,e,f,g=/\b(https?\:\/\/)?([\w.\-]*@)?((?:[a-z0-9\-]+)(?:\.[a-z0-9\-]+)*(?:\.[a-z]{2,4}))((?:\/|\?)\S*)?\b/g,h=["span"],i=0;null!==(b=g.exec(a));)h.push(a.substring(i,b.index)),c=b[1],d=b[2],e=b[3],f=b[4]||"",c=c||(d?"mailto:":"http://"),d=d||"",i=g.lastIndex,h.push(["a",{href:c+d+e+f,target:"_blank"},b[0]]);return h.push(a.substring(i)),h}function d(b){return b?["span",{"class":"scrollback-message-nick",onmouseout:function(){f.userStyle&&f.userStyle.parentNode.removeChild(f.userStyle)},onmouseover:function(){var c={".scrollback-tread-row":{width:"0 !important"}};c[".scrollback-user-"+b]={background:hashColor(a.from)+" !important",width:"100% !important"},f.userStyle=addStyles(c)}},0===b.indexOf("guest-")?b.replace("guest-",""):b]:""}var e,f=this,g=new RegExp("\\b"+core.nick().replace(/^guest-/,"")+"\\b"),h=g.test(a.text)&&a.from!=core.nick()?" scrollback-message-mentioned ":"";switch(a.type){case"text":e=[["span",{"class":"scrollback-message-separator"},"["],d(a.from)],0===a.text.indexOf("/me ")?(e.push(["span",c(a.text.substr(3))]),e.push(["span",{"class":"scrollback-message-separator"},"] "])):(e.push(["span",{"class":"scrollback-message-separator"},"] "]),e.push(["span",{"class":"scrollback-message-content"},c(a.text)]));break;case"back":e=[["span",d(a.from)," entered."]];break;case"away":e=["span",d(a.from)," left"],a.text?e.push(" (",c(a.text),")"):e.push("."),e=[e];break;case"nick":e=[["span",d(a.from)," is now known as ",d(a.ref)]];break;default:e=[["span",a.text]]}return b&&a.time&&e.push(["span",{"class":"scrollback-message-timestamp"},"Sent "+prettyDate(a.time,core.time())]),e?(console.log(),e=JsonML.parse(["div",{"class":"scrollback-message scrollback-message-"+a.type+h,style:{borderLeftColor:hashColor(a.from)},"data-time":a.time,"data-from":d(a.from)}].concat(e))):null};var browserNotify=function(){var a=!1,b=document.title,c=!1,d="",e=function(){var a,b="data:audio/wav;base64,UklGRnQGAABXQVZFZm10IBAAAAABAAEAESsAABErAAABAAgAZGF0YU8GAACBgIF/gn2Cf4B+gn5+fYJ/gIF/gH+BfX6AfXt5fXx7e3x9fH1+f4CAfnx9f3t9gIB9en2Dfn58fYKDgIJ9hnh7hIZ8gYR6fHyCe4GCioF+gH93foWCgoJ5gHx5gniAeYJ0dneCgXN1jn1+fI1zfHp8dYiCe3qIhHpmfXqMeZJ0ACb/AAD//wAAQ/8A3pYANv/qYek5OGp3tICeexjYUkWgYMzzAB//hDyVcX2Yi5ppXLNsXYKEZ3l7aHGTn1pnlZlwVpuUgqOKgIOMYIpsoXVydJKdc296kZl3h3OAcoV6ao6Be298ipCFhIFxk3yIeXNuh4eHiYh/c3h1eJCUenCCfH9yeZSKcHR7eH9ugYl+eImFfWxuhX1uiIx+gYZmg355hHlzgXl1dIeWdGmciXpteYWMc3GOfntye5Khh1+beoaFgmJ5k4KUe3CXim2GdJaFYXmec1GomG97b4mZcnCIbX6EbX6LbWd1e4B0d4x6cXuKcoKMdoB5eZt9doh0e32Ag5CSgnOEkIWBgX6AeYqRenJ9hoKDhIR6gIBte42DeHuFhm18g35we4x9dnmBgHp+bniBfIF2eYB3fYV3dX+FdIOCf3Z7foF8e4mAfHuCdn+Lc3WKhXyEhnt7goF4foSDhH17f4uFfnp/io90c4OBfHuCg4JyhIxycH2JgnuDiHl8hH98dIODdIKBeIZ8fHeCiXx+f3SIf3V7eYSCdHuCgnh6hIFzioV3gYuAeXl9e4V7e3+JgnV6gIJ7hIiCe3yIinx9hYGAhX17h4OBfICFfIiFfHh9hn93gnp2hYR6foF4dn9/dX1/eX9/dHN+goB3eoF8fHt6f316fIF6gIF8eH2Cgnt/goV6iHx3iIR6f4CDg3uGg3yAiIN9g4B/gn+CgX59hn96fn+FfX59f4SCgIR7foJ7fYGAfoF6f4F5fHyDfXmFfnt5hIB5fn1/fX1+gHl9foN8fYGCfoCGen6AgoB/gH9/g3p8fYWGfXqDhH17gIOCfn+CeoCDg3p6fIGFfXp/gYR9dYN/gX57e359foJ9foGAf357gICAfIJ7fn16hoV6fXyAgX+Bfn5+gnl5gYSBfH19e4h7fISEeIB+gH+Ed3+Cf3p6hX2Af3qAfX5/fn98f4GBgHt3gYZ/fX99gHx8gH97hoR3gX5/g3l+g31/g315f4N8fX+AgX6Af35+gH6AgX97foCCfX99gn1+gYF7gIR9en+DgH59f319gYB8fn1/f32Be3uCgXx+fYR/fH2Cf31+foKEfHyBg31/fn5/goJ7gIaAfX9/gn+Bgn56g4J/goF/foB/gIB/fn+Bf3uAgn96f398gIB/fnyAgHx9fn5+f3p+gnx9f3x/f398f399gH9/fn6Df3yBf39/gIB9f4F/gYF+f4CCfoF/f4KCgICAf4KAg4B+f4KCfX59goN9fYB/gIB6gH99fICAfX1/gnx7fYB/gXx9fn5/fn99fX5+fX5+fn5/f39/gX5/gnx+gIF/foCCfn2Af4J+foGBgX9/f4CCfIGAgYF/f36AgYB+gIGAgH2AgX99gH9/gH2Af3+AfXx9gHx+fHyAfX5+fH2Agnt7f35/fX9/f39/fXp+gH5+goB9f39/gn59gX+Af31/gIB/f39/gH6AgICBfoCEf4B+f4KBf4B/gYGDfn+Af4B/fn59foF+foKBfn9+fHyAfn5+fn+BeX+Fg3N7hX58gH+Afn6FdHuIgnh+g4B6e4iGeHqFhXh7g3+Af36Ag4SAeX+Een1+g4V7en6Ef3+AgX9/f4B+fHx+foJ/fH6ChHx9foGBg3t5foJ/f3x+fYF+f31+gICBgX5/f4F+fn5/fX59fn9+gIOAf3+Af4B9fn9+gX9+gX+BfoGBgIB/f31/gn+CfIB/fYF+f36Bf35/foB/f398gX+Af31/f4CBf358gIKAfn9+gn2Af35+gn99f36Bf31+f3+Af399f4CBfoCAfX+BfX+AgH6AgH9+gIZ9fYJ/iIB3fIt/dISBgHx/f4OFf32AgX53fIOCe4KBfn2Ben57f3t4f4N9gH6BgYKAgHl/gn1/f4N/f36DgoCBfoJ+eX17gH18e4F/fYB+hX6Dg4OBgIB8fHt+f39+fX9/foKBgIGEf31/gX6AgoGDfoCEf32BAA==";return function(){a||(a=document.createElement("div"),a.style.display="none",document.body.appendChild(a)),a.innerHTML='<audio autoplay="autoplay"><source src="'+b+'" type="audio/wav" /><embed hidden="true" autostart="true" loop="false" src="'+b+'" /></audio>'}}();return DomReady.ready(function(){addEvent(window,"focus",function(){document.title==d&&(document.title=b),a=!0}),addEvent(window,"blur",function(){b||(b=document.title),a=!1}),a=document.hasFocus()}),function(f,g){a||(document.title!==d&&(b=document.title),document.title=f,d=f,(!c||g)&&(e(),c=!0,setTimeout(function(){c=!1},6e4)))}}(),dialog=function(){function a(){b.style.display="none"}var b,c,d,e;return e=0==scrollback.host.indexOf("//")?scrollback.host.replace(/^\/\//,"https://"):scrollback.host.replace(/^http:/,"https:"),addEvent(window,"message",function(a){var b;if(a.origin==e){if("string"==typeof a.data)try{b=JSON.parse(a.data)}catch(c){return scrollback.debug&&console.log("Error parsing incoming message: ",a.data,c),void 0}else b=a.data;d&&d(b)}}),{show:function(f,g){d=g,b||(b=JsonML.parse(["div",{"class":"scrollback-dialog-layer",onclick:a},["div",{"class":"scrollback-dialog"},["div",{"class":"scrollback-dialog-close scrollback-icon scrollback-icon-close",onclick:a},"Ã—"],["iframe",{"class":"scrollback-dialog-frame",allowtransparency:!0,id:"scrollback-dialog-frame",frameborder:"0"}]]]),document.body.appendChild(b),c=document.getElementById("scrollback-dialog-frame")),c.src=e+f,b.style.display="block"},hide:a,send:function(a,b){c.contentWindow.postMessage({type:a,data:b},e)}}}();
